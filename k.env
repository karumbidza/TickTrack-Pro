VS CODE PROMPT â€” TickTrack Pro Orders Module Integration

Context
You are working inside an existing production codebase called TickTrack Pro (Helpdesk + Project Management system).
Your task is to ADD a complete Orders module that follows existing architectural patterns, naming conventions, authentication, authorization, logging, and UI standards.
â— Do NOT rewrite or break existing workflows.
â— Only extend the system cleanly.

1ï¸âƒ£ FEATURE TO ADD: ORDERS MODULE (TOGGLEABLE)
Feature Toggle (MANDATORY)

Add a feature flag: orders_enabled

Scope: per business / tenant

Controlled ONLY by Super Admin

If orders_enabled = false:

Hide Orders UI

Block all Orders API routes

Return 403 â€“ Orders feature disabled for this business

Store flag in:

business_settings (
  business_id,
  orders_enabled boolean default false
)

2ï¸âƒ£ TWO DISTINCT ORDERING WORKFLOWS (DO NOT MIX)
A) PURCHASE ORDERS (Admin â†’ Suppliers â†’ Warehouse)
B) INTERNAL ORDERS (Managers â†’ Warehouse â†’ Sites)

These are separate flows, separate endpoints, shared inventory & stock ledger.

3ï¸âƒ£ DATABASE CHANGES (EXTEND, DONâ€™T BREAK)
Purchase Orders

Create tables:

suppliers
supplier_orders
supplier_order_items


Supplier Orders:

order_number (PO-{timestamp})

status: pending â†’ sent â†’ received â†’ cancelled

total_amount

audit fields (created_by, created_at)

Internal Orders

Create tables:

orders
order_items
site_inventory
uniform_issuance
stock_movements


Stock Movements is mandatory for all inventory changes.

4ï¸âƒ£ PURCHASE ORDER WORKFLOW (ADMIN ONLY)
STEP 1: Create PO (UI)

Shopping cart pattern (in-memory array)

Prevent duplicate items

Supplier selection filters inventory categories

Real-time totals

STEP 2: Submit PO

Endpoint

POST /api/suppliers/orders/create


Rules

Transactional insert

Status defaults to pending

Rollback on failure

STEP 3: Manage PO Status

Status flow

pending â†’ sent â†’ received â†’ cancelled


Endpoints:

PATCH /api/suppliers/orders/:id/status
GET   /api/suppliers/orders/:id/pdf

STEP 4: Receive Goods (CRITICAL)
POST /api/suppliers/orders/:id/receive


Rules

Update warehouse inventory

Log stock_movements (type: supplier_delivery)

Once committed â†’ irreversible

Update status to received

5ï¸âƒ£ INTERNAL ORDER WORKFLOW (MANAGER â†’ ADMIN)
STEP 1: Manager Creates Order

Permissions

Managers: ONLY their site

Admins: All sites

Order Types

Uniform

Stationery

Consumables

Fuel

Shopping Cart

Item-specific fields (uniform sizes, fuel type, etc.)

Must contain â‰¥1 item

STEP 2: Submit Order
POST /api/orders


Rules:

Auto deadline:

urgent â†’ 2 days

normal â†’ 7 days

Status: pending

Managers only see their siteâ€™s orders

STEP 3: Admin Processes Order
POST /api/orders/:id/process


Status: pending â†’ processing

Audit who processed

STEP 4: Admin Dispatches Order (CRITICAL)
POST /api/orders/:id/dispatch


Rules

Lock inventory rows (FOR UPDATE)

Validate stock availability

Deduct warehouse inventory

Log stock_movements (negative quantity)

Uniform orders:

Insert into uniform_issuance

Rollback entire transaction if ANY item fails

STEP 5: Manager Receives Order
POST /api/orders/:id/receive


Rules:

Managers only

Update order status to received

Update site_inventory (upsert logic)

Receipt status:

complete / partial / damaged

6ï¸âƒ£ UI / UX RULES (MATCH EXISTING STYLE)
Required Components

DataTable (filters, search)

ShoppingCart component

StatusBadge component

Bootstrap 5 modals

Confirm dialogs for irreversible actions

Toast notifications

Status Badges

Use consistent color mapping:

pending â†’ warning

processing â†’ info

sent â†’ primary

dispatched â†’ success

received â†’ secondary

cancelled â†’ danger

7ï¸âƒ£ ROLE-BASED ACCESS (STRICT)
Manager

âœ… Create internal orders
âœ… View own site orders
âœ… Receive orders
âŒ Create POs
âŒ Dispatch orders
âŒ View other sites

Admin

âœ… All manager permissions
âœ… Purchase Orders
âœ… Receive supplier stock
âœ… Dispatch internal orders
âœ… Inventory control

Super Admin

âœ… Toggle orders_enabled per business

8ï¸âƒ£ BUSINESS RULES (NON-NEGOTIABLE)

No dispatch if stock insufficient

No receiving twice

No skipping statuses

No duplicate cart items

All inventory changes MUST log to stock_movements

All critical actions must be transactional

9ï¸âƒ£ API & SECURITY

JWT authentication

Middleware:

checkOrdersEnabled

requireRole(admin|manager|super_admin)

Return meaningful error codes

Never partially commit stock changes

ğŸ”š FINAL INSTRUCTION

ğŸ‘‰ Merge this Orders module cleanly into TickTrack Pro
ğŸ‘‰ Reuse existing patterns, folder structure, and utilities
ğŸ‘‰ Do NOT introduce breaking changes
ğŸ‘‰ Produce clean, readable, production-ready code